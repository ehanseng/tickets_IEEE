name: Deploy to Server via SFTP

on:
  push:
    branches:
      - master  # Se ejecuta cuando haces push a master
  workflow_dispatch:  # TambiÃ©n permite ejecuciÃ³n manual desde GitHub

jobs:
  deploy:
    name: Deploy to Production Server
    runs-on: ubuntu-latest

    steps:
      - name: ğŸš€ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“‚ Deploy to Server via SFTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftps  # Usar ftps (FTP over SSL) o sftp segÃºn tu servidor
          port: 21  # Puerto FTP estÃ¡ndar (21 para FTP, 22 para SFTP)
          local-dir: ./  # Directorio local (raÃ­z del proyecto)
          server-dir: /  # Directorio remoto (ajustar segÃºn tu estructura)
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/tickets.db
            **/qr_codes/*.png
            **/__pycache__/
            **/*.pyc
            **/.env
            **/deploy_package.zip
            **/ssh_commands.txt
            **/explore_server.ps1
            **/deploy_to_server.sh
            **/upload_via_sftp.ps1
          dangerous-salt-bow: "true"  # Requerido para confirmar que quieres usar esta acciÃ³n

      - name: âœ… Deployment Complete
        run: |
          echo "ğŸ‰ Deployment to ticket.ieeetadeo.org completed successfully!"
          echo "ğŸ“¦ Files uploaded via SFTP"
          echo "ğŸŒ Visit: https://ticket.ieeetadeo.org"
