name: Deploy to Server via SFTP

on:
  push:
    branches:
      - master  # Se ejecuta cuando haces push a master
  workflow_dispatch:  # También permite ejecución manual desde GitHub

jobs:
  deploy:
    name: Deploy to Production Server
    runs-on: ubuntu-latest

    steps:
      - name: 🚀 Checkout code
        uses: actions/checkout@v4

      - name: 📂 Deploy to Server via SFTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftps  # Usar ftps (FTP over SSL) o sftp según tu servidor
          port: 21  # Puerto FTP estándar (21 para FTP, 22 para SFTP)
          local-dir: ./  # Directorio local (raíz del proyecto)
          server-dir: /  # Directorio remoto (ajustar según tu estructura)
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            **/tickets.db
            **/qr_codes/*.png
            **/__pycache__/
            **/*.pyc
            **/.env
            **/deploy_package.zip
            **/ssh_commands.txt
            **/explore_server.ps1
            **/deploy_to_server.sh
            **/upload_via_sftp.ps1
          dangerous-salt-bow: "true"  # Requerido para confirmar que quieres usar esta acción

      - name: ✅ Deployment Complete
        run: |
          echo "🎉 Deployment to ticket.ieeetadeo.org completed successfully!"
          echo "📦 Files uploaded via SFTP"
          echo "🌐 Visit: https://ticket.ieeetadeo.org"
